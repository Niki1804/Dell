module.exports=function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e){t.exports=require("vscode")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(8),s=i(0);e.getRootWorkspacePath=function(){const t=s.workspace;return t&&t.workspaceFolders&&t.workspaceFolders.length>0?s.workspace.workspaceFolders[0].uri.fsPath:""},e.fileExists=function(t){try{return n.statSync(t).isFile()}catch(t){return!1}},e.dirExists=function(t){try{return n.statSync(t).isDirectory()}catch(t){return!1}},e.stripQuotes=function(t){return t.substr(1,t.length-2)}},function(t,e){t.exports=require("path")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);class s{constructor(){this._appStatus=n.window.createStatusBarItem(n.StatusBarAlignment.Right,5),this._appStatus.text=s._okMsg,this._appStatus.command=s.DEFAULT_COMMAND,this._appStatus.show();n.window.activeTextEditor?(this._appStatus.show(),this._isHidden=!1):(this._appStatus.hide(),this._isHidden=!0)}static get _thinkingMsg(){return`${s._appName} ${s.APP_THINKING_ICON}`}static get _errorsMsg(){return`${s._appName} ${s.APP_HAS_ERR_ICON}`}static get _okMsg(){return`${s._appName} ${s.APP_IS_OK_ICON}`}static setAppName(t){s._appName=s._appName||t}static getInstance(){return null==s._instance&&(s._instance=s.create()),s._instance}static create(){return new s}show(){this._isHidden&&(this._appStatus.text=s._okMsg,this._appStatus.show(),this._isHidden=!1)}hide(){this._appStatus.hide(),this._isHidden=!0}thinking(){this._appStatus.text=s._thinkingMsg}errors(){this._appStatus.text=s._errorsMsg}ok(){this._appStatus.text=s._okMsg}dispose(){this._appStatus.dispose()}}e.AppStatus=s,s.DEFAULT_COMMAND="workbench.actions.view.problems",s.APP_THINKING_ICON="$(clock)",s.APP_IS_OK_ICON="$(check)",s.APP_HAS_ERR_ICON="$(alert)",s._instance=null},function(t,e){t.exports=require("os")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),s=i(6);e.ApexPmd=s.ApexPmd;const o=i(14),r=i(3),a=i(15),l=i(1),u=["apex","visualforce","xml"],c=t=>0<=u.indexOf(t),h=n.languages.createDiagnosticCollection("apex-pmd"),f=n.window.createOutputChannel("Apex PMD");e.activate=function(t){const e=new o.Config(t),i=new s.ApexPmd(f,e);r.AppStatus.setAppName("Apex PMD"),r.AppStatus.getInstance().ok(),t.subscriptions.push(n.commands.registerCommand("apex-pmd.clearProblems",()=>{h.clear()})),t.subscriptions.push(n.commands.registerCommand("apex-pmd.runWorkspace",()=>{n.window.withProgress({location:n.ProgressLocation.Notification,title:"Running Static Analysis on workspace",cancellable:!0},(t,e)=>(t.report({increment:0}),i.run(l.getRootWorkspacePath(),h,t,e)))})),t.subscriptions.push(n.commands.registerCommand("apex-pmd.runFileMenu",t=>{i.run(t.fsPath,h)})),t.subscriptions.push(n.commands.registerCommand("apex-pmd.runFile",t=>{t||(t=n.window.activeTextEditor.document.fileName),i.run(t,h)})),e.runOnFileSave&&n.workspace.onDidSaveTextDocument(t=>{if(c(t.languageId))return n.commands.executeCommand("apex-pmd.runFile",t.fileName)}),e.runOnFileChange&&n.workspace.onDidChangeTextDocument(a.debounce(t=>{const e=t.document;if(c(e.languageId))return n.commands.executeCommand("apex-pmd.runFile",e.fileName)},e.onFileChangeDebounce)),e.runOnFileOpen&&n.window.onDidChangeActiveTextEditor(t=>{if(c(t.document.languageId))return n.commands.executeCommand("apex-pmd.runFile",t.document.fileName,!0)}),n.workspace.onDidChangeConfiguration(t=>{if(t.affectsConfiguration("apexPMD"))return e.init(),i.updateConfiguration(e)}),t.subscriptions.push(n.window.onDidChangeVisibleTextEditors(t=>{t.some(t=>t.document&&c(t.document.languageId))?r.AppStatus.getInstance().show():r.AppStatus.getInstance().hide()}))},e.deactivate=function(){}},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),o=i(7),r=i(2),a=i(3),l=i(4),u=i(1),c=i(9),h="win32"===l.platform()?";":":";e.ApexPmd=class{constructor(t,e){this.config=e,this.rulesets=this.getValidRulesetPaths(e.rulesets),this.outputChannel=t}updateConfiguration(t){this.config=t,this.rulesets=this.getValidRulesetPaths(t.rulesets)}run(t,e,i,o){return n(this,void 0,void 0,(function*(){this.outputChannel.appendLine("Analyzing "+t),a.AppStatus.getInstance().thinking();let n=!1;if(o&&o.onCancellationRequested(()=>{n=!0}),this.checkPmdPath()&&this.hasAtLeastOneValidRuleset())try{const r=yield this.executeCmd(t,o),l=this.parseProblems(r);if(l.size>0){a.AppStatus.getInstance().errors(),i&&i.report({message:`Processing ${l.size} file(s)`});const t=1/l.size*100;for(const[o,r]of l){if(n)return;i&&i.report({increment:t});try{const t=s.Uri.file(o),i=yield s.workspace.openTextDocument(t);r.forEach(t=>{const e=i.lineAt(t.range.start.line);t.range=new s.Range(new s.Position(e.range.start.line,e.firstNonWhitespaceCharacterIndex),e.range.end)}),e.set(t,r)}catch(t){this.outputChannel.appendLine(t)}}}else{const i=s.Uri.file(t);e.delete(i),a.AppStatus.getInstance().ok()}}catch(t){a.AppStatus.getInstance().errors(),s.window.showErrorMessage("Static Analysis Failed. Error Details: "+t)}}))}getRulesets(){return this.rulesets}getValidRulesetPaths(t){return t.filter(t=>this.checkRulesetPath(t))}hasAtLeastOneValidRuleset(){return!!this.rulesets.length||(s.window.showErrorMessage('No valid Ruleset paths found in "apexPMD.rulesets". Ensure configuration correct or change back to the default.'),!1)}executeCmd(t,e){return n(this,void 0,void 0,(function*(){const{workspaceRootPath:i,enableCache:n,pmdBinPath:s,additionalClassPaths:a,showStdOut:l,showStdErr:u,commandBufferSize:c,showErrors:f}=this.config,d=i+"/.pmdCache",_=this.rulesets.join(","),m=`-f csv ${n?`--cache "${d}"`:"--no-cache"} ${`-d "${t}"`} ${`-R "${_}"`}`,p=[r.join(s,"lib","*"),r.join(i,"*"),...a].join(h),g=`${this.config.jrePath?r.join(this.config.jrePath,"bin","java"):"java"} -cp "${p}" net.sourceforge.pmd.PMD ${m}`;l&&this.outputChannel.appendLine("PMD Command: "+g);const w=o.exec(g,{maxBuffer:1024*Math.max(c,1)*1024});e&&e.onCancellationRequested(()=>{w.kill()});let v="";return new Promise((t,e)=>{w.addListener("error",t=>{f&&this.outputChannel.appendLine("error:"+t),e(t)}),w.addListener("exit",i=>{0!==i&&4!==i&&(this.outputChannel.appendLine("Failed Exit Code: "+i),v||e('PMD Command Failed!  Enable "Show StdErr" setting for more info.')),t(v)}),w.stdout.on("data",t=>{l&&this.outputChannel.appendLine("stdout:"+t),v+=t}),w.stderr.on("data",t=>{u&&this.outputChannel.appendLine("stderr:"+t)})})}))}parseProblems(t){const e=c.parsePmdCsv(t),i=new Map;let n=0;for(let t=1;t<e.length;t++)try{const s=e[t];if(!e[t])continue;if(s.file.includes(".sfdx"))continue;const o=this.createDiagnostic(s);if(!o)continue;n++,i.has(s.file)?i.get(s.file).push(o):i.set(s.file,[o])}catch(t){this.outputChannel.appendLine(t)}return this.outputChannel.appendLine(n+" issue(s) found"),i}createDiagnostic(t){const{priorityErrorThreshold:e,priorityWarnThreshold:i}=this.config,n=parseInt(t.line)-1,o=`https://pmd.github.io/latest/pmd_rules_apex_${t.ruleSet.split(" ").join("").toLowerCase()}.html#${t.rule.toLowerCase()}`,r=`${t.description} (rule: ${t.ruleSet}-${t.rule})`,a=parseInt(t.priority);if(isNaN(n))return null;let l;l=a<=e?s.DiagnosticSeverity.Error:a<=i?s.DiagnosticSeverity.Warning:s.DiagnosticSeverity.Information;const u=new s.Diagnostic(new s.Range(new s.Position(n,0),new s.Position(n,100)),r,l);return u.code={target:s.Uri.parse(o),value:t.rule},u.source="apex pmd",u}checkPmdPath(){const{pmdBinPath:t}=this.config;return!!u.dirExists(t)||(this.outputChannel.appendLine(t),s.window.showErrorMessage("PMD Path Does not reference a valid directory.  Please update or clear"),!1)}checkRulesetPath(t){return!!u.fileExists(t)||(s.window.showErrorMessage(`No Ruleset not found at ${t}. Ensure configuration correct or change back to the default.`),!1)}}},function(t,e){t.exports=require("child_process")},function(t,e){t.exports=require("fs")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(10),s=i(4),o=i(0),r=["problem","package","file","priority","line","description","ruleSet","rule"];e.parsePmdCsv=function(t){let e;const i={columns:r,relax_column_count:!0};try{e=n(t,i)}catch(r){const a=t.split(s.EOL);a.pop(),t=a.join(s.EOL);try{e=n(t,i)}catch(t){throw new Error("Failed to parse PMD Results.  Enable please logging (STDOUT & STDERROR) and submit an issue if this problem persists.")}o.window.showWarningMessage("Failed to read all PMD problems!")}return e}},function(t,e,i){const n=i(11);t.exports=function(t,e={}){"string"==typeof t&&(t=Buffer.from(t));const i=e&&e.objname?{}:[],s=new n.Parser(e);s.push=function(t){void 0===e.objname?i.push(t):i[t[0]]=t[1]};const o=s.__parse(t,!1);if(void 0!==o)throw o;const r=s.__parse(void 0,!0);if(void 0!==r)throw r;return i}},function(t,e,i){const{Transform:n}=i(12),s=i(13),o=Buffer.from([239,187,191]);class r extends n{constructor(t={}){super({readableObjectMode:!0,...t});const e={};for(let i in t)e[u(i)]=t[i];if(void 0===e.bom||null===e.bom||!1===e.bom)e.bom=!1;else if(!0!==e.bom)throw new l("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,","got "+JSON.stringify(e.bom)]);let i=null;if(void 0===e.cast||null===e.cast||!1===e.cast||""===e.cast)e.cast=void 0;else if("function"==typeof e.cast)i=e.cast,e.cast=!0;else if(!0!==e.cast)throw new l("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,","got "+JSON.stringify(e.cast)]);if(void 0===e.cast_date||null===e.cast_date||!1===e.cast_date||""===e.cast_date)e.cast_date=!1;else if(!0===e.cast_date)e.cast_date=function(t){const e=Date.parse(t);return isNaN(e)?t:new Date(e)};else if("function"!=typeof e.cast_date)throw new l("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,","got "+JSON.stringify(e.cast_date)]);let n=null;if(!0===e.columns)n=void 0;else if("function"==typeof e.columns)n=e.columns,e.columns=!0;else if(Array.isArray(e.columns))e.columns=f(e.columns);else{if(void 0!==e.columns&&null!==e.columns&&!1!==e.columns)throw new l("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an object, a function or true,","got "+JSON.stringify(e.columns)]);e.columns=!1}if(void 0===e.comment||null===e.comment||!1===e.comment||""===e.comment)e.comment=null;else if("string"==typeof e.comment&&(e.comment=Buffer.from(e.comment)),!Buffer.isBuffer(e.comment))throw new l("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,","got "+JSON.stringify(e.comment)]);if(void 0===e.delimiter||null===e.delimiter||!1===e.delimiter)e.delimiter=Buffer.from(",");else if("string"==typeof e.delimiter&&0!==e.delimiter.length)e.delimiter=Buffer.from(e.delimiter);else if(Buffer.isBuffer(e.delimiter)&&0===e.delimiter.length||"string"==typeof e.delimiter&&0===e.delimiter.length||!Buffer.isBuffer(e.delimiter)&&"string"!=typeof e.delimiter)throw new l("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer,","got "+JSON.stringify(e.delimiter)]);if(void 0===e.escape||null===e.escape?e.escape=Buffer.from('"'):"string"==typeof e.escape&&(e.escape=Buffer.from(e.escape)),!Buffer.isBuffer(e.escape))throw new Error("Invalid Option: escape must be a buffer or a string, got "+JSON.stringify(e.escape));if(1!==e.escape.length)throw new Error("Invalid Option Length: escape must be one character, got "+e.escape.length);if(e.escape=e.escape[0],void 0===e.from||null===e.from)e.from=1;else{if("string"==typeof e.from&&/\d+/.test(e.from)&&(e.from=parseInt(e.from)),!Number.isInteger(e.from))throw new Error("Invalid Option: from must be an integer, got "+JSON.stringify(e.from));if(e.from<0)throw new Error("Invalid Option: from must be a positive integer, got "+JSON.stringify(t.from))}if(void 0===e.from_line||null===e.from_line)e.from_line=1;else{if("string"==typeof e.from_line&&/\d+/.test(e.from_line)&&(e.from_line=parseInt(e.from_line)),!Number.isInteger(e.from_line))throw new Error("Invalid Option: from_line must be an integer, got "+JSON.stringify(t.from_line));if(e.from_line<=0)throw new Error("Invalid Option: from_line must be a positive integer greater than 0, got "+JSON.stringify(t.from_line))}if(void 0===e.info||null===e.info||!1===e.info)e.info=!1;else if(!0!==e.info)throw new Error("Invalid Option: info must be true, got "+JSON.stringify(e.info));if(void 0===e.max_record_size||null===e.max_record_size||!1===e.max_record_size)e.max_record_size=0;else if(Number.isInteger(e.max_record_size)&&e.max_record_size>=0);else{if("string"!=typeof e.max_record_size||!/\d+/.test(e.max_record_size))throw new Error("Invalid Option: max_record_size must be a positive integer, got "+JSON.stringify(e.max_record_size));e.max_record_size=parseInt(e.max_record_size)}if(void 0===e.objname||null===e.objname||!1===e.objname)e.objname=void 0;else if(Buffer.isBuffer(e.objname)){if(0===e.objname.length)throw new Error("Invalid Option: objname must be a non empty buffer");e.objname=e.objname.toString()}else{if("string"!=typeof e.objname)throw new Error("Invalid Option: objname must be a string or a buffer, got "+e.objname);if(0===e.objname.length)throw new Error("Invalid Option: objname must be a non empty string")}if(void 0===e.on_record||null===e.on_record)e.on_record=void 0;else if("function"!=typeof e.on_record)throw new l("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,","got "+JSON.stringify(e.on_record)]);if(null===e.quote||!1===e.quote||""===e.quote)e.quote=null;else{if(void 0===e.quote||!0===e.quote?e.quote=Buffer.from('"'):"string"==typeof e.quote&&(e.quote=Buffer.from(e.quote)),!Buffer.isBuffer(e.quote))throw new Error("Invalid Option: quote must be a buffer or a string, got "+JSON.stringify(e.quote));if(1!==e.quote.length)throw new Error("Invalid Option Length: quote must be one character, got "+e.quote.length);e.quote=e.quote[0]}if(void 0===e.raw||null===e.raw||!1===e.raw)e.raw=!1;else if(!0!==e.raw)throw new Error("Invalid Option: raw must be true, got "+JSON.stringify(e.raw));if(e.record_delimiter?Array.isArray(e.record_delimiter)||(e.record_delimiter=[e.record_delimiter]):e.record_delimiter=[],e.record_delimiter=e.record_delimiter.map((function(t){return"string"==typeof t&&(t=Buffer.from(t)),t})),"boolean"==typeof e.relax);else{if(void 0!==e.relax&&null!==e.relax)throw new Error("Invalid Option: relax must be a boolean, got "+JSON.stringify(e.relax));e.relax=!1}if("boolean"==typeof e.relax_column_count);else{if(void 0!==e.relax_column_count&&null!==e.relax_column_count)throw new Error("Invalid Option: relax_column_count must be a boolean, got "+JSON.stringify(e.relax_column_count));e.relax_column_count=!1}if("boolean"==typeof e.relax_column_count_less);else{if(void 0!==e.relax_column_count_less&&null!==e.relax_column_count_less)throw new Error("Invalid Option: relax_column_count_less must be a boolean, got "+JSON.stringify(e.relax_column_count_less));e.relax_column_count_less=!1}if("boolean"==typeof e.relax_column_count_more);else{if(void 0!==e.relax_column_count_more&&null!==e.relax_column_count_more)throw new Error("Invalid Option: relax_column_count_more must be a boolean, got "+JSON.stringify(e.relax_column_count_more));e.relax_column_count_more=!1}if("boolean"==typeof e.skip_empty_lines);else{if(void 0!==e.skip_empty_lines&&null!==e.skip_empty_lines)throw new Error("Invalid Option: skip_empty_lines must be a boolean, got "+JSON.stringify(e.skip_empty_lines));e.skip_empty_lines=!1}if("boolean"==typeof e.skip_lines_with_empty_values);else{if(void 0!==e.skip_lines_with_empty_values&&null!==e.skip_lines_with_empty_values)throw new Error("Invalid Option: skip_lines_with_empty_values must be a boolean, got "+JSON.stringify(e.skip_lines_with_empty_values));e.skip_lines_with_empty_values=!1}if("boolean"==typeof e.skip_lines_with_error);else{if(void 0!==e.skip_lines_with_error&&null!==e.skip_lines_with_error)throw new Error("Invalid Option: skip_lines_with_error must be a boolean, got "+JSON.stringify(e.skip_lines_with_error));e.skip_lines_with_error=!1}if(void 0===e.rtrim||null===e.rtrim||!1===e.rtrim)e.rtrim=!1;else if(!0!==e.rtrim)throw new Error("Invalid Option: rtrim must be a boolean, got "+JSON.stringify(e.rtrim));if(void 0===e.ltrim||null===e.ltrim||!1===e.ltrim)e.ltrim=!1;else if(!0!==e.ltrim)throw new Error("Invalid Option: ltrim must be a boolean, got "+JSON.stringify(e.ltrim));if(void 0===e.trim||null===e.trim||!1===e.trim)e.trim=!1;else if(!0!==e.trim)throw new Error("Invalid Option: trim must be a boolean, got "+JSON.stringify(e.trim));if(!0===e.trim&&!1!==t.ltrim?e.ltrim=!0:!0!==e.ltrim&&(e.ltrim=!1),!0===e.trim&&!1!==t.rtrim?e.rtrim=!0:!0!==e.rtrim&&(e.rtrim=!1),void 0===e.to||null===e.to)e.to=-1;else{if("string"==typeof e.to&&/\d+/.test(e.to)&&(e.to=parseInt(e.to)),!Number.isInteger(e.to))throw new Error("Invalid Option: to must be an integer, got "+JSON.stringify(t.to));if(e.to<=0)throw new Error("Invalid Option: to must be a positive integer greater than 0, got "+JSON.stringify(t.to))}if(void 0===e.to_line||null===e.to_line)e.to_line=-1;else{if("string"==typeof e.to_line&&/\d+/.test(e.to_line)&&(e.to_line=parseInt(e.to_line)),!Number.isInteger(e.to_line))throw new Error("Invalid Option: to_line must be an integer, got "+JSON.stringify(t.to_line));if(e.to_line<=0)throw new Error("Invalid Option: to_line must be a positive integer greater than 0, got "+JSON.stringify(t.to_line))}this.info={comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},this.options=e,this.state={bomSkipped:!1,castField:i,commenting:!1,enabled:1===e.from_line,escaping:!1,escapeIsQuote:e.escape===e.quote,expectedRecordLength:null===e.columns?0:e.columns.length,field:new s(20),firstLineToHeaders:n,info:Object.assign({},this.info),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new s(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:0===e.record_delimiter.length?2:Math.max(...e.record_delimiter.map(t=>t.length)),trimChars:[Buffer.from(" ")[0],Buffer.from("\t")[0]],wasQuoting:!1,wasRowDelimiter:!1}}_transform(t,e,i){if(!0===this.state.stop)return;const n=this.__parse(t,!1);void 0!==n&&(this.state.stop=!0),i(n)}_flush(t){if(!0===this.state.stop)return;t(this.__parse(void 0,!0))}__parse(t,e){const{bom:i,comment:n,escape:s,from_line:r,info:a,ltrim:u,max_record_size:c,quote:h,raw:f,relax:d,rtrim:_,skip_empty_lines:m,to:p,to_line:g}=this.options;let{record_delimiter:w}=this.options;const{bomSkipped:v,previousBuf:b,rawBuffer:y,escapeIsQuote:O}=this.state;let x;if(void 0===b){if(void 0===t)return void this.push(null);x=t}else x=void 0!==b&&void 0===t?b:Buffer.concat([b,t]);if(!1===v)if(!1===i)this.state.bomSkipped=!0;else if(x.length<3){if(!1===e)return void(this.state.previousBuf=x)}else 0===o.compare(x,0,3)&&(x=x.slice(3)),this.state.bomSkipped=!0;const S=x.length;let P;for(P=0;P<S&&!this.__needMoreData(P,S,e);P++){if(!0===this.state.wasRowDelimiter&&(this.info.lines++,!0===a&&0===this.state.record.length&&0===this.state.field.length&&!1===this.state.wasQuoting&&(this.state.info=Object.assign({},this.info)),this.state.wasRowDelimiter=!1),-1!==g&&this.info.lines>g)return this.state.stop=!0,void this.push(null);if(!1===this.state.quoting&&0===w.length){this.__autoDiscoverRowDelimiter(x,P)&&(w=this.options.record_delimiter)}const t=x[P];if(!0===f&&y.append(t),13!==t&&10!==t||!1!==this.state.wasRowDelimiter||(this.state.wasRowDelimiter=!0),!0===this.state.escaping)this.state.escaping=!1;else{if(!0===this.state.quoting&&t===s&&P+1<S){if(!O){this.state.escaping=!0;continue}if(x[P+1]===h){this.state.escaping=!0;continue}}if(!1===this.state.commenting&&t===h)if(!0===this.state.quoting){const e=x[P+1],i=_&&this.__isCharTrimable(e),o=null!==n&&this.__compareBytes(n,x,P+1,e),r=this.__isDelimiter(e,x,P+1),a=0===w.length?this.__autoDiscoverRowDelimiter(x,P+1):this.__isRecordDelimiter(e,x,P+1);if(t===s&&e===h)P++;else{if(!e||r||a||o||i){this.state.quoting=!1,this.state.wasQuoting=!0;continue}if(!1===d){const t=this.__error(new l("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(e)}"`,"at line "+this.info.lines,"instead of delimiter, row delimiter, trimable character","(if activated) or comment"],this.__context()));if(void 0!==t)return t}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(h)}}else{if(0===this.state.field.length){this.state.quoting=!0;continue}if(!1===d){const t=this.__error(new l("INVALID_OPENING_QUOTE",["Invalid Opening Quote:","a quote is found inside a field at line "+this.info.lines],this.__context(),{field:this.state.field}));if(void 0!==t)return t}}if(!1===this.state.quoting){let e=this.__isRecordDelimiter(t,x,P);if(0!==e){if(this.state.commenting&&!1===this.state.wasQuoting&&0===this.state.record.length&&0===this.state.field.length)this.info.comment_lines++;else{if(!0===m&&!1===this.state.wasQuoting&&0===this.state.record.length&&0===this.state.field.length){this.info.empty_lines++,P+=e-1;continue}if(!1===this.state.enabled&&this.info.lines+(!0===this.state.wasRowDelimiter?1:0)>=r){this.state.enabled=!0,this.__resetField(),this.__resetRow(),P+=e-1;continue}{const t=this.__onField();if(void 0!==t)return t;const e=this.__onRow();if(void 0!==e)return e}if(-1!==p&&this.info.records>=p)return this.state.stop=!0,void this.push(null)}this.state.commenting=!1,P+=e-1;continue}if(this.state.commenting)continue;if(0!==(null===n?0:this.__compareBytes(n,x,P,t))){this.state.commenting=!0;continue}let i=this.__isDelimiter(t,x,P);if(0!==i){const t=this.__onField();if(void 0!==t)return t;P+=i-1;continue}}}if(!1===this.state.commenting&&0!==c&&this.state.record_length+this.state.field.length>c){const t=this.__error(new l("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes","of "+c,"at line "+this.info.lines],this.__context()));if(void 0!==t)return t}const e=!1===u||!0===this.state.quoting||0!==this.state.field.length||!this.__isCharTrimable(t),i=!1===_||!1===this.state.wasQuoting;if(!0===e&&!0===i)this.state.field.append(t);else if(!0===_&&!this.__isCharTrimable(t)){const t=this.__error(new l("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote","at line "+this.info.lines],this.__context()));if(void 0!==t)return t}}if(!0===e)if(!0===this.state.quoting){const t=this.__error(new l("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:","the parsing is finished with an opening quote at line "+this.info.lines],this.__context()));if(void 0!==t)return t}else if(!0===this.state.wasQuoting||0!==this.state.record.length||0!==this.state.field.length){const t=this.__onField();if(void 0!==t)return t;const e=this.__onRow();if(void 0!==e)return e}else!0===this.state.wasRowDelimiter?this.info.empty_lines++:!0===this.state.commenting&&this.info.comment_lines++;else this.state.previousBuf=x.slice(P);!0===this.state.wasRowDelimiter&&(this.info.lines++,this.state.wasRowDelimiter=!1)}__isCharTrimable(t){return 32===t||9===t||13===t||10===t}__onRow(){const{columns:t,info:e,from:i,relax_column_count:n,relax_column_count_less:s,relax_column_count_more:o,raw:r,skip_lines_with_empty_values:a}=this.options,{enabled:u,record:c}=this.state;if(!1===u)return this.__resetRow();const f=c.length;if(!0===t)return h(c)?void this.__resetRow():this.__firstLineToColumns(c);if(!1===t&&0===this.info.records&&(this.state.expectedRecordLength=f),f!==this.state.expectedRecordLength)if(!0===n||!0===s&&f<this.state.expectedRecordLength||!0===o&&f>this.state.expectedRecordLength)this.info.invalid_field_length++;else if(!1===t){const t=this.__error(new l("CSV_INCONSISTENT_RECORD_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${f} on line ${this.info.lines}`],this.__context(),{record:c}));if(void 0!==t)return t}else{const e=this.__error(new l("CSV_RECORD_DONT_MATCH_COLUMNS_LENGTH",["Invalid Record Length:",`columns length is ${t.length},`,`got ${f} on line ${this.info.lines}`],this.__context(),{record:c}));if(void 0!==e)return e}if(!0===a&&h(c))this.__resetRow();else{if(!0===this.state.recordHasError)return this.__resetRow(),void(this.state.recordHasError=!1);if(this.info.records++,1===i||this.info.records>=i)if(!1!==t){const i={};for(let e in c)void 0===t[e]||t[e].disabled||(i[t[e].name]=c[e]);const{objname:n}=this.options;if(void 0===n)if(!0===r||!0===e){const t=this.__push(Object.assign({record:i},!0===r?{raw:this.state.rawBuffer.toString()}:{},!0===e?{info:this.state.info}:{}));if(t)return t}else{const t=this.__push(i);if(t)return t}else if(!0===r||!0===e){const t=this.__push(Object.assign({record:[i[n],i]},!0===r?{raw:this.state.rawBuffer.toString()}:{},!0===e?{info:this.state.info}:{}));if(t)return t}else{const t=this.__push([i[n],i]);if(t)return t}}else if(!0===r||!0===e){const t=this.__push(Object.assign({record:c},!0===r?{raw:this.state.rawBuffer.toString()}:{},!0===e?{info:this.state.info}:{}));if(t)return t}else{const t=this.__push(c);if(t)return t}this.__resetRow()}}__firstLineToColumns(t){const{firstLineToHeaders:e}=this.state;try{const i=void 0===e?t:e.call(null,t);if(!Array.isArray(i))return this.__error(new l("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,","got "+JSON.stringify(i)],this.__context(),{headers:i}));const n=f(i);return this.state.expectedRecordLength=n.length,this.options.columns=n,void this.__resetRow()}catch(t){return t}}__resetRow(){!0===this.options.raw&&this.state.rawBuffer.reset(),this.state.record=[],this.state.record_length=0}__onField(){const{cast:t,rtrim:e,max_record_size:i}=this.options,{enabled:n,wasQuoting:s}=this.state;if(!1===n)return this.__resetField();let o=this.state.field.toString();if(!0===e&&!1===s&&(o=o.trimRight()),!0===t){const[t,e]=this.__cast(o);if(void 0!==t)return t;o=e}this.state.record.push(o),0!==i&&"string"==typeof o&&(this.state.record_length+=o.length),this.__resetField()}__resetField(){this.state.field.reset(),this.state.wasQuoting=!1}__push(t){const{on_record:e}=this.options;if(void 0!==e){const i=this.__context();try{t=e.call(null,t,i)}catch(t){return t}if(null==t)return}this.push(t)}__cast(t){const{columns:e,relax_column_count:i}=this.options;if(!0===Array.isArray(e)&&i&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];const n=this.__context();if(null!==this.state.castField)try{return[void 0,this.state.castField.call(null,t,n)]}catch(t){return[t]}return this.__isFloat(t)?[void 0,parseFloat(t)]:!1!==this.options.cast_date?[void 0,this.options.cast_date.call(null,t,n)]:[void 0,t]}__isFloat(t){return t-parseFloat(t)+1>=0}__compareBytes(t,e,i,n){if(t[0]!==n)return 0;const s=t.length;for(let n=1;n<s;n++)if(t[n]!==e[i+n])return 0;return s}__needMoreData(t,e,i){if(i)return!1;const{comment:n,delimiter:s}=this.options,{quoting:o,recordDelimiterMaxLength:r}=this.state;return e-t-1<Math.max(n?n.length:0,r,o?1+r:0,s.length,1)}__isDelimiter(t,e,i){const{delimiter:n}=this.options,s=n.length;if(n[0]!==t)return 0;for(let t=1;t<s;t++)if(n[t]!==e[i+t])return 0;return n.length}__isRecordDelimiter(t,e,i){const{record_delimiter:n}=this.options,s=n.length;t:for(let o=0;o<s;o++){const s=n[o],r=s.length;if(s[0]===t){for(let t=1;t<r;t++)if(s[t]!==e[i+t])continue t;return s.length}}return 0}__autoDiscoverRowDelimiter(t,e){const i=t[e];return 13===i?10===t[e+1]?(this.options.record_delimiter.push(Buffer.from("\r\n")),this.state.recordDelimiterMaxLength=2,2):(this.options.record_delimiter.push(Buffer.from("\r")),this.state.recordDelimiterMaxLength=1,1):10===i?(this.options.record_delimiter.push(Buffer.from("\n")),this.state.recordDelimiterMaxLength=1,1):0}__error(t){const{skip_lines_with_error:e}=this.options,i="string"==typeof t?new Error(t):t;return e?(this.state.recordHasError=!0,void this.emit("skip",i)):i}__context(){const{columns:t}=this.options;return{column:!0===Array.isArray(t)?t.length>this.state.record.length?t[this.state.record.length].name:null:this.state.record.length,empty_lines:this.info.empty_lines,header:!0===t,index:this.state.record.length,invalid_field_length:this.info.invalid_field_length,quoting:this.state.wasQuoting,lines:this.info.lines,records:this.info.records}}}const a=function(){let t,e,i;for(let n in arguments){const s=arguments[n],o=typeof s;if(void 0!==t||"string"!=typeof s&&!Buffer.isBuffer(s))if(void 0===e&&c(s))e=s;else{if(void 0!==i||"function"!==o)throw new l("CSV_INVALID_ARGUMENT",["Invalid argument:",`got ${JSON.stringify(s)} at index ${n}`]);i=s}else t=s}const n=new r(e);if(i){const t=void 0===e||void 0===e.objname?[]:{};n.on("readable",(function(){let i;for(;null!==(i=this.read());)void 0===e||void 0===e.objname?t.push(i):t[i[0]]=i[1]})),n.on("error",(function(t){i(t,void 0,n.info)})),n.on("end",(function(){i(void 0,t,n.info)}))}return void 0!==t&&("function"==typeof setImmediate?setImmediate((function(){n.write(t),n.end()})):(n.write(t),n.end())),n};class l extends Error{constructor(t,e,...i){Array.isArray(e)&&(e=e.join(" ")),super(e),void 0!==Error.captureStackTrace&&Error.captureStackTrace(this,l),this.code=t;for(const t of i)for(const e in t){const i=t[e];this[e]=Buffer.isBuffer(i)?i.toString():null==i?i:JSON.parse(JSON.stringify(i))}}}a.Parser=r,a.CsvError=l,t.exports=a;const u=function(t){return t.replace(/([A-Z])/g,(function(t,e){return"_"+e.toLowerCase()}))},c=function(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)},h=function(t){return t.every(t=>null==t||t.toString&&""===t.toString().trim())},f=function(t){const e=[];for(let i=0;i<t.length;i++){const n=t[i];if(null==n||!1===n)e[i]={disabled:!0};else if("string"==typeof n)e[i]={name:n};else{if(!c(n))throw new l("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(n)} at position ${i}`]);if("string"!=typeof n.name)throw new l("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",'property "name" is required at position '+i,"when column is an object literal"]);e[i]=n}}return e}},function(t,e){t.exports=require("stream")},function(t,e){t.exports=class{constructor(t=100){this.size=t,this.length=0,this.buf=Buffer.alloc(t)}prepend(t){const e=this.length++;e===this.size&&this.resize();const i=this.clone();this.buf[0]=t,i.copy(this.buf,1,0,e)}append(t){const e=this.length++;e===this.size&&this.resize(),this.buf[e]=t}clone(){return Buffer.from(this.buf.slice(0,this.length))}resize(){const t=this.length;this.size=2*this.size;const e=Buffer.alloc(this.size);this.buf.copy(e,0,0,t),this.buf=e}toString(){return this.buf.slice(0,this.length).toString()}toJSON(){return this.toString()}reset(){this.length=0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),s=i(2),o=i(1);e.Config=class{constructor(t){t?(this._ctx=t,this.init()):console.warn("VSCode ApexPMD missing configuration")}init(){const t=n.workspace.getConfiguration("apexPMD");this._rulesetPath=t.get("rulesetPath"),this.workspaceRootPath=o.getRootWorkspacePath(),this.rulesets=t.get("rulesets"),this.pmdBinPath=t.get("pmdBinPath"),this.priorityErrorThreshold=t.get("priorityErrorThreshold"),this.priorityWarnThreshold=t.get("priorityWarnThreshold"),this.runOnFileOpen=t.get("runOnFileOpen"),this.runOnFileSave=t.get("runOnFileSave"),this.runOnFileChange=t.get("runOnFileChange"),this.onFileChangeDebounce=t.get("onFileChangeDebounce"),this.showErrors=t.get("showErrors"),this.showStdOut=t.get("showStdOut"),this.showStdErr=t.get("showStdErr"),this.enableCache=t.get("enableCache"),this.additionalClassPaths=t.get("additionalClassPaths"),this.commandBufferSize=t.get("commandBufferSize"),this.jrePath=t.get("jrePath"),this.resolvePaths()}resolvePaths(){this.rulesets||(this.rulesets=[]),this.rulesets.length&&(this.rulesets=this.rulesets.map(t=>{let e=t;return"default"===e.toLowerCase()?e=this._ctx.asAbsolutePath(s.join("rulesets","apex_ruleset.xml")):!s.isAbsolute(e)&&this.workspaceRootPath&&(e=s.join(this.workspaceRootPath,e)),e})),this._rulesetPath||this.rulesets.length?this._rulesetPath&&!s.isAbsolute(this._rulesetPath)&&this.workspaceRootPath&&(this._rulesetPath=s.join(this.workspaceRootPath,this._rulesetPath)):this._rulesetPath=this._ctx.asAbsolutePath(s.join("rulesets","apex_ruleset.xml")),this._rulesetPath&&this.rulesets.push(this._rulesetPath),this.pmdBinPath||(this.pmdBinPath=this._ctx.asAbsolutePath(s.join("bin","pmd"))),this.pmdBinPath&&!s.isAbsolute(this.pmdBinPath)&&this.workspaceRootPath&&(this.pmdBinPath=s.join(this.workspaceRootPath,this.pmdBinPath)),this.jrePath&&!s.isAbsolute(this.jrePath)&&this.workspaceRootPath&&(this.jrePath=s.join(this.workspaceRootPath,this.jrePath)),this.additionalClassPaths||(this.additionalClassPaths=[]),this.additionalClassPaths.length&&(this.additionalClassPaths=this.additionalClassPaths.map(t=>{let e=t;return!s.isAbsolute(t)&&this.workspaceRootPath&&(e=s.join(this.workspaceRootPath,t)),e}))}}},function(t,e){function i(t,e,i){var n,s,o,r,a;function l(){var u=Date.now()-r;u<e&&u>=0?n=setTimeout(l,e-u):(n=null,i||(a=t.apply(o,s),o=s=null))}null==e&&(e=100);var u=function(){o=this,s=arguments,r=Date.now();var u=i&&!n;return n||(n=setTimeout(l,e)),u&&(a=t.apply(o,s),o=s=null),a};return u.clear=function(){n&&(clearTimeout(n),n=null)},u.flush=function(){n&&(a=t.apply(o,s),o=s=null,clearTimeout(n),n=null)},u}i.debounce=i,t.exports=i}]);
//# sourceMappingURL=extension.js.map